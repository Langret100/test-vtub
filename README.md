# VTuber Room Chat (Three.js + VRM + Web Speech TTS)

이 프로젝트는 **GitHub Pages에서 바로 열리는 단일 페이지 웹앱**입니다.
- **Three.js**로 3D 교실(코너 디오라마) + VRM 캐릭터를 렌더링
- 사용자가 채팅을 치면 캐릭터가 **다가오고(approach)** → **멈춰서(respond)** → **카메라를 바라보며** 감정 리액션
- **Web Speech API(TTS)** 로 텍스트를 음성으로 읽고, 간단한 규칙 기반 **입모양(립싱크)** 적용

> 모바일(특히 Android)은 브라우저 정책상 **사용자 제스처 이후에만** 소리 재생이 됩니다.
> 그래서 우측 상단 **“음성 켜기”** 버튼을 한 번 눌러야 TTS가 나옵니다.

---

## 빠른 실행 / 배포

### 로컬 실행
정적 파일만 있으므로 아무 정적 서버로 실행 가능합니다.
예:
- VS Code Live Server
- `python -m http.server` (단, 모듈 import 경로가 맞아야 함)

### GitHub Pages 배포
1. ZIP 안의 파일들을 레포 루트에 업로드
2. GitHub → Settings → Pages → Branch 선택 후 저장
3. Pages URL로 접속

---

## 주요 파일

- `index.html` : UI 레이아웃(캔버스 + 채팅)
- `styles.css` : 반응형 레이아웃(모바일은 **스테이지 크게 / 채팅 작게**)
- `app.js` : 메인 로직(3D, VRM 로딩, 시선/상호작용, 감정 리액션, TTS, 립싱크)
- `assets/avatar.vrm` : 여자 캐릭터 VRM

---

## VRMA(다운받은 모션) 적용

이제 **다운받아 둔 VRMA 모션**을 프로젝트에 넣으면 자동으로 적용됩니다.

1) 아래 폴더를 만들고 파일을 넣기:
- `assets/motions/idle.vrma`
- `assets/motions/walk.vrma`

2) 새로고침하면 자동 감지해서 적용됩니다.
- 파일이 없으면 기존처럼 **절차적 모션**으로 동작합니다.
- 말하거나 감정 제스처(손 흔들기 등)를 할 때는 위 모션 위에 자연스럽게 오버레이됩니다.

---

## 동작 구조(요약)

### 1) 상호작용 상태
- `wander` : 교실 내부를 천천히 돌아다님
- `approach` : 채팅이 오면 카메라 쪽으로 다가감
- `respond` : 가까이 오면 멈춰서 반응

### 2) “앞/뒤” 보정
VRM마다 기본 정면(+Z/-Z)이 달라서 **걷는 방향이 뒤로 보이는 문제**가 생길 수 있습니다.
- 로딩 직후 카메라 방향과 비교해 `yawOffset`을 자동으로 결정
- 이동/회전 계산 시 `+ yawOffset`을 적용해 **정면으로 걷는 것처럼 보이게** 했습니다.

### 3) 팔 벌림(T-포즈) 완화
많은 VRM이 기본 포즈가 T에 가까워서 그대로 두면 “팔 벌리고 걸음”처럼 보일 수 있습니다.
- `BASE` 포즈를 강하게(팔 내리고 손 모으기) 적용
- 걷는 동안에도 팔 스윙을 거의 없애서 안정적인 실루엣 유지

---

## 감정 키워드

채팅에 아래 단어가 포함되면 감정별 리액션/대사가 나옵니다.
- 인사/안녕/hi → greet
- 기쁨/행복/축하 → happy
- 슬픔/우울/힘들 → sad
- 화남/짜증/열받 → angry
- 고마워/감사 → thanks
- 미안/죄송 → sorry
- 졸려/피곤 → sleepy
- 놀람/헉/대박 → surprise
- 부끄/귀여/좋아해 → shy
- 생각/고민/흠 → think

---

## 다음에 이어서 만들기(할 일)

원하면 아래를 다음 단계로 확장 가능합니다.
- **진짜 애니메이션 클립**(idle/walk/emote)을 glTF/VRMA로 교체
- 방 안에서 **경로 탐색/충돌 회피**(벽/가구 피해서 걷기)
- 시선/상체 회전 **IK 기반**으로 더 자연스럽게
- TTS를 브라우저 내장 대신 **서버/Edge TTS 등 외부 엔진 연동**(정책/비용 고려)

“걸을 때 항상 먼저 방향을 틀고 이동 시작(뒤로 걷기 완전 차단)”

“idle/walk를 진짜 애니메이션 클립(VRMA/GLB) 로 교체(현재는 절차적 포즈/워크 사이클이라 모델에 따라 한계 있음)”

